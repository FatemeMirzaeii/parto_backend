image: node:latest
stages:
    - build
    - test
    - deploy
   
cache:
  paths:
    - node_modules/
    

testing_parto:
    stage: test
    variables:
      NODE_ENV: "test"
    script:
        - echo "testing Parto..."
        - echo $NODE_ENV
        - npm install
        - npx sequelize-cli db:create --charset utf8mb4 --collate utf8mb4_persian_ci
        - npx sequelize-cli db:migrate
        - npx sequelize-cli db:seed:all
        - npm test
        - echo "testing succsecfull"
building_parto:
  stage: build
  variables:
     NODE_ENV: "test"
  
  script: 
    - echo "Running Parto..."
    - echo $NODE_ENV
    - killall node || echo "No other instnaces is running."
    - npm install
    - npx sequelize-cli db:create --charset utf8mb4 --collate utf8mb4_persian_ci
    - npx sequelize-cli db:migrate
    - npx sequelize-cli db:seed:all
    - pm2 start app.js
    
    

       
    